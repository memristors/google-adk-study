# ADK A2Aï¼ˆAgent-to-Agentï¼‰åè®®è¯¦è§£

## ä¸€ã€ä»€ä¹ˆæ˜¯ A2A

A2Aï¼ˆAgent-to-Agentï¼‰æ˜¯ Google äº 2025 å¹´ 4 æœˆå‘å¸ƒçš„ä¸€ä¸ªå¼€æ”¾é€šä¿¡åè®®ï¼Œç”¨äºè®©ä¸åŒçš„ AI Agent ä¹‹é—´èƒ½å¤Ÿç›¸äº’å‘ç°ã€é€šä¿¡å’Œåä½œã€‚å®ƒåŸºäº HTTPã€JSON-RPCã€SSE ç­‰æ ‡å‡† Web æŠ€æœ¯æ„å»ºã€‚

å¯ä»¥æŠŠ A2A ç†è§£ä¸º **Agent ä¸–ç•Œçš„ HTTP åè®®** â€”â€” å°±åƒ HTTP è®©ä¸åŒçš„ Web æœåŠ¡èƒ½äº’ç›¸é€šä¿¡ä¸€æ ·ï¼ŒA2A è®©ä¸åŒçš„ Agent èƒ½äº’ç›¸å¯¹è¯ã€‚

## äºŒã€A2A vs Sub-Agent çš„æ ¸å¿ƒåŒºåˆ«

| ç»´åº¦ | Sub-Agentï¼ˆæœ¬åœ°å­ä»£ç†ï¼‰ | A2Aï¼ˆè¿œç¨‹ä»£ç†ï¼‰ |
|------|----------------------|----------------|
| è¿è¡Œä½ç½® | åŒä¸€è¿›ç¨‹å†… | è·¨è¿›ç¨‹/è·¨ç½‘ç»œ/è·¨æœºå™¨ |
| å…±äº«å†…å­˜ | å…±äº« Session State | ä¸å…±äº«å†…å­˜ã€å·¥å…·ã€æ€è€ƒè¿‡ç¨‹ |
| æ¡†æ¶è¦æ±‚ | å¿…é¡»éƒ½æ˜¯ ADK Agent | å¯ä»¥æ˜¯ä»»æ„æ¡†æ¶ï¼ˆADKã€LangGraphã€CrewAI ç­‰ï¼‰ |
| ç¼–ç¨‹è¯­è¨€ | å¿…é¡»éƒ½æ˜¯ Python | å¯ä»¥è·¨è¯­è¨€ï¼ˆPythonã€Javaã€Go ç­‰ï¼‰ |
| é€šä¿¡æ–¹å¼ | å‡½æ•°è°ƒç”¨ï¼ˆtransfer_to_agentï¼‰ | HTTP + JSON-RPC |
| éƒ¨ç½²æ–¹å¼ | å•ä½“éƒ¨ç½² | ç‹¬ç«‹éƒ¨ç½²ï¼Œå¾®æœåŠ¡æ¶æ„ |
| å›¢é˜Ÿåä½œ | åŒä¸€å›¢é˜Ÿç»´æŠ¤ | ä¸åŒå›¢é˜Ÿ/ä¸åŒç»„ç»‡å„è‡ªç»´æŠ¤ |
| å‘ç°æœºåˆ¶ | ä»£ç ä¸­ç›´æ¥å¼•ç”¨ | é€šè¿‡ Agent Card è‡ªæè¿°å‘ç° |

ç®€å•æ€»ç»“ï¼š
- **Sub-Agent** = åŒä¸€ä¸ªæˆ¿å­é‡Œçš„å®¶äººï¼Œå…±äº«å¨æˆ¿å’Œå®¢å…
- **A2A** = ä¸åŒå…¬å¸ä¹‹é—´çš„åˆä½œï¼Œé€šè¿‡æ ‡å‡†åˆåŒå’Œé‚®ä»¶æ²Ÿé€š

## ä¸‰ã€ä»€ä¹ˆæ—¶å€™ç”¨ A2A

é€‚åˆç”¨ A2A çš„åœºæ™¯ï¼š
1. Agent è¿è¡Œåœ¨ä¸åŒçš„æœåŠ¡å™¨/è¿›ç¨‹ä¸Š
2. Agent ä½¿ç”¨ä¸åŒçš„ç¼–ç¨‹è¯­è¨€æˆ–æ¡†æ¶
3. Agent ç”±ä¸åŒçš„å›¢é˜Ÿæˆ–ç»„ç»‡ç»´æŠ¤
4. éœ€è¦å¾®æœåŠ¡æ¶æ„ï¼ˆè®¢å• Agentã€åº“å­˜ Agentã€ç‰©æµ Agent å„è‡ªç‹¬ç«‹ï¼‰
5. éœ€è¦æ¥å…¥ç¬¬ä¸‰æ–¹æä¾›çš„ Agent æœåŠ¡

ä¸é€‚åˆç”¨ A2A çš„åœºæ™¯ï¼ˆç”¨ Sub-Agent æ›´å¥½ï¼‰ï¼š
1. æ‰€æœ‰ Agent åœ¨åŒä¸€ä¸ª Python è¿›ç¨‹ä¸­
2. Agent ä¹‹é—´éœ€è¦å…±äº« Session State
3. éœ€è¦æä½å»¶è¿Ÿçš„å†…éƒ¨åè°ƒ
4. åŒä¸€ä¸ªå›¢é˜Ÿç»´æŠ¤çš„ç´§å¯†è€¦åˆçš„ Agent

## å››ã€ä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨ API æ¥å£

è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é—®é¢˜ã€‚A2A ç›¸æ¯”æ™®é€š REST API çš„æ ¸å¿ƒä»·å€¼ï¼š

### 1. æ ‡å‡†åŒ–çš„èƒ½åŠ›å‘ç°ï¼ˆAgent Cardï¼‰
æ™®é€š API éœ€è¦ä½ æå‰çŸ¥é“æ¥å£æ–‡æ¡£ã€‚A2A çš„ Agent Card è®© Agent èƒ½è‡ªåŠ¨å‘ç°å¯¹æ–¹çš„èƒ½åŠ›ï¼š
```json
{
  "name": "check_prime_agent",
  "description": "æ£€æŸ¥æ•°å­—æ˜¯å¦ä¸ºè´¨æ•°çš„ä¸“ä¸š Agent",
  "skills": [
    {
      "id": "prime_checking",
      "name": "è´¨æ•°æ£€æŸ¥",
      "description": "é«˜æ•ˆåˆ¤æ–­æ•°å­—æ˜¯å¦ä¸ºè´¨æ•°"
    }
  ],
  "url": "http://localhost:8001/a2a/check_prime_agent"
}
```

### 2. LLM åŸç”Ÿçš„äº¤äº’æ–¹å¼
æ™®é€š API è¿”å›çš„æ˜¯ç»“æ„åŒ–æ•°æ®ï¼Œè°ƒç”¨æ–¹éœ€è¦è‡ªå·±è§£æã€‚A2A çš„äº¤äº’æ˜¯è‡ªç„¶è¯­è¨€çº§åˆ«çš„ï¼ŒAgent ä¹‹é—´å¯ä»¥åƒäººä¸€æ ·å¯¹è¯åå•†ã€‚

### 3. æ”¯æŒé•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡
æ™®é€š API æ˜¯è¯·æ±‚-å“åº”æ¨¡å¼ã€‚A2A æ”¯æŒå¼‚æ­¥ä»»åŠ¡ã€æµå¼è¿”å›ã€ä»»åŠ¡çŠ¶æ€æŸ¥è¯¢ï¼Œå¤©ç„¶é€‚åˆ Agent çš„å·¥ä½œæ¨¡å¼ã€‚

### 4. æ¡†æ¶æ— å…³
ä¸ç®¡å¯¹æ–¹ç”¨çš„æ˜¯ ADKã€LangGraphã€CrewAI è¿˜æ˜¯è‡ªç ”æ¡†æ¶ï¼Œåªè¦å®ç°äº† A2A åè®®å°±èƒ½é€šä¿¡ã€‚æ™®é€š API æ¯ä¸ªæœåŠ¡çš„æ¥å£æ ¼å¼éƒ½ä¸ä¸€æ ·ã€‚

### 5. å¤šæ¨¡æ€æ”¯æŒ
A2A ä¸ä»…æ”¯æŒæ–‡æœ¬ï¼Œè¿˜æ”¯æŒ JSONã€å›¾ç‰‡ã€PDF ç­‰å¤šç§æ•°æ®æ ¼å¼çš„äº¤æ¢ã€‚

**ä¸€å¥è¯æ€»ç»“**ï¼šAPI æ˜¯"æˆ‘è°ƒä½ çš„å‡½æ•°"ï¼ŒA2A æ˜¯"æˆ‘çš„ Agent å’Œä½ çš„ Agent å¯¹è¯åä½œ"ã€‚

## äº”ã€A2A çš„åŒé‡è§’è‰²

ä¸€ä¸ª ADK Agent **æ—¢å¯ä»¥ä½œä¸ºæ¶ˆè´¹ç«¯ï¼Œåˆå¯ä»¥ä½œä¸ºç”Ÿäº§ç«¯**ï¼š

### ä½œä¸ºç”Ÿäº§ç«¯ï¼ˆExposing / æš´éœ²æœåŠ¡ï¼‰
æŠŠä½ çš„ Agent é€šè¿‡ A2A Server æš´éœ²å‡ºå»ï¼Œè®©åˆ«äººçš„ Agent å¯ä»¥è°ƒç”¨ï¼š
```
ä½ çš„ Agent â†’ A2AServer â†’ ç½‘ç»œ â†’ å…¶ä»– Agent å¯ä»¥è®¿é—®
```

### ä½œä¸ºæ¶ˆè´¹ç«¯ï¼ˆConsuming / æ¶ˆè´¹æœåŠ¡ï¼‰
é€šè¿‡ `RemoteA2aAgent` è°ƒç”¨åˆ«äººæš´éœ²çš„ Agentï¼š
```
ä½ çš„ Agent â†’ RemoteA2aAgent â†’ ç½‘ç»œ â†’ è¿œç¨‹ A2A Server â†’ è¿œç¨‹ Agent
```

### åŒæ—¶å……å½“ä¸¤ç§è§’è‰²
ä¸€ä¸ª Agent å®Œå…¨å¯ä»¥åŒæ—¶æš´éœ²è‡ªå·±çš„èƒ½åŠ›ç»™åˆ«äººç”¨ï¼ŒåŒæ—¶ä¹Ÿæ¶ˆè´¹å…¶ä»–è¿œç¨‹ Agent çš„èƒ½åŠ›ã€‚è¿™å°±åƒä¸€ä¸ªå¾®æœåŠ¡æ—¢æä¾› API ç»™åˆ«äººè°ƒç”¨ï¼Œä¹Ÿä¼šè°ƒç”¨å…¶ä»–å¾®æœåŠ¡çš„ APIã€‚

## å…­ã€ç®€å•ä¾‹å­ï¼šæ·éª°å­ + è´¨æ•°æ£€æŸ¥

è¿™æ˜¯ ADK å®˜æ–¹çš„ a2a_basic ç¤ºä¾‹ï¼Œéå¸¸ç›´è§‚ã€‚

### æ¶æ„è¯´æ˜
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Root Agent (æœ¬åœ°)              â”‚
â”‚  "æˆ‘èƒ½æ·éª°å­ï¼Œä¹Ÿèƒ½æ£€æŸ¥è´¨æ•°"               â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Roll Agent   â”‚  â”‚ Prime Agent     â”‚  â”‚
â”‚  â”‚ (æœ¬åœ°å­ä»£ç†)  â”‚  â”‚ (RemoteA2aAgent)â”‚  â”‚
â”‚  â”‚ æ·éª°å­       â”‚  â”‚ ä»£ç†è¿œç¨‹è´¨æ•°æ£€æŸ¥  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚ A2A åè®® (HTTP)
                              â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚  è¿œç¨‹ A2A Server (:8001) â”‚
                 â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                 â”‚  â”‚ Check Prime Agent â”‚  â”‚
                 â”‚  â”‚ çœŸæ­£æ‰§è¡Œè´¨æ•°æ£€æŸ¥    â”‚  â”‚
                 â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1. è¿œç¨‹ Agentï¼ˆç”Ÿäº§ç«¯ï¼‰â€”â€” è´¨æ•°æ£€æŸ¥ Agent

ç›®å½•ç»“æ„ï¼š
```
a2a_basic/
â”œâ”€â”€ agent.py                          # ä¸» Agentï¼ˆæ¶ˆè´¹ç«¯ï¼‰
â””â”€â”€ remote_a2a/
    â””â”€â”€ check_prime_agent/
        â”œâ”€â”€ __init__.py
        â”œâ”€â”€ agent.py                  # è´¨æ•°æ£€æŸ¥ Agent
        â””â”€â”€ agent-card.json           # Agent èƒ½åŠ›æè¿°å¡ç‰‡
```

`remote_a2a/check_prime_agent/agent.py`ï¼š
```python
from google.adk.agents import Agent

def check_prime(nums: list[int]) -> dict:
    """æ£€æŸ¥ä¸€ç»„æ•°å­—æ˜¯å¦ä¸ºè´¨æ•°"""
    results = {}
    for n in nums:
        if n < 2:
            results[n] = False
            continue
        is_prime = all(n % i != 0 for i in range(2, int(n**0.5) + 1))
        results[n] = is_prime
    return results

root_agent = Agent(
    model="gemini-2.0-flash",
    name="check_prime_agent",
    description="æ£€æŸ¥æ•°å­—æ˜¯å¦ä¸ºè´¨æ•°çš„ Agent",
    instruction="ä½ æ˜¯ä¸€ä¸ªæ•°å­¦åŠ©æ‰‹ï¼Œä¸“é—¨æ£€æŸ¥æ•°å­—æ˜¯å¦ä¸ºè´¨æ•°ã€‚ä½¿ç”¨ check_prime å·¥å…·ã€‚",
    tools=[check_prime],
)
```

`agent-card.json`ï¼š
```json
{
  "name": "check_prime_agent",
  "description": "æ£€æŸ¥æ•°å­—æ˜¯å¦ä¸ºè´¨æ•°çš„ä¸“ä¸š Agent",
  "skills": [
    {
      "id": "prime_checking",
      "name": "Prime Number Checking",
      "description": "é«˜æ•ˆåˆ¤æ–­æ•°å­—æ˜¯å¦ä¸ºè´¨æ•°",
      "tags": ["mathematical", "computation", "prime"]
    }
  ],
  "url": "http://localhost:8001/a2a/check_prime_agent",
  "version": "1.0.0"
}
```

å¯åŠ¨è¿œç¨‹ Agent çš„ A2A Serverï¼š
```cmd
adk api_server --a2a --port 8001 remote_a2a/check_prime_agent
```

### 2. ä¸» Agentï¼ˆæ¶ˆè´¹ç«¯ï¼‰â€”â€” æ·éª°å­ + è°ƒç”¨è¿œç¨‹è´¨æ•°æ£€æŸ¥

`agent.py`ï¼š
```python
import random
from google.adk.agents import Agent
from google.adk.agents.remote_a2a_agent import RemoteA2aAgent

# æœ¬åœ°å·¥å…·ï¼šæ·éª°å­
def roll_die(sides: int = 6) -> int:
    """æ·ä¸€ä¸ªéª°å­ï¼Œè¿”å›ç»“æœ"""
    return random.randint(1, sides)

# æœ¬åœ°å­ä»£ç†ï¼šæ·éª°å­
roll_agent = Agent(
    model="gemini-2.0-flash",
    name="roll_agent",
    description="è´Ÿè´£æ·éª°å­çš„ Agent",
    instruction="ä½ è´Ÿè´£æ·éª°å­ã€‚ä½¿ç”¨ roll_die å·¥å…·ã€‚",
    tools=[roll_die],
)

# è¿œç¨‹ä»£ç†ï¼šé€šè¿‡ A2A åè®®è¿æ¥è¿œç¨‹è´¨æ•°æ£€æŸ¥ Agent
prime_agent = RemoteA2aAgent(
    name="prime_agent",
    description="é€šè¿‡ A2A åè®®è¿æ¥çš„è¿œç¨‹è´¨æ•°æ£€æŸ¥ Agent",
    agent_card="http://localhost:8001/a2a/check_prime_agent/agent-card.json",
)

# æ ¹ Agentï¼šåè°ƒæœ¬åœ°å’Œè¿œç¨‹ Agent
root_agent = Agent(
    model="gemini-2.0-flash",
    name="root_agent",
    instruction="""
      ä½ æ˜¯ä¸€ä¸ªåŠ©æ‰‹ï¼Œå¯ä»¥æ·éª°å­å’Œæ£€æŸ¥è´¨æ•°ã€‚
      1. ç”¨æˆ·è¦æ·éª°å­ â†’ å§”æ´¾ç»™ roll_agent
      2. ç”¨æˆ·è¦æ£€æŸ¥è´¨æ•° â†’ å§”æ´¾ç»™ prime_agent
      3. ç”¨æˆ·è¦æ·éª°å­å¹¶æ£€æŸ¥ç»“æœæ˜¯å¦ä¸ºè´¨æ•° â†’ å…ˆè°ƒ roll_agentï¼Œå†æŠŠç»“æœä¼ ç»™ prime_agent
    """,
    sub_agents=[roll_agent, prime_agent],
)
```

å¯åŠ¨ä¸» Agentï¼š
```cmd
adk web .
```

### 3. äº¤äº’ç¤ºä¾‹

```
ç”¨æˆ·: æ·ä¸€ä¸ªéª°å­
Agent: ğŸ² æ·å‡ºäº† 5

ç”¨æˆ·: 5 æ˜¯è´¨æ•°å—ï¼Ÿ
Agent: âœ… 5 æ˜¯è´¨æ•°ï¼ˆé€šè¿‡è¿œç¨‹ A2A Agent æ£€æŸ¥ï¼‰

ç”¨æˆ·: æ·ä¸€ä¸ªéª°å­ï¼Œç„¶åå‘Šè¯‰æˆ‘ç»“æœæ˜¯ä¸æ˜¯è´¨æ•°
Agent: ğŸ² æ·å‡ºäº† 4ï¼ŒâŒ 4 ä¸æ˜¯è´¨æ•°
```

## ä¸ƒã€æ ¸å¿ƒæ¦‚å¿µæ€»ç»“

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  A2A åè®®ç”Ÿæ€                     â”‚
â”‚                                                  â”‚
â”‚  Agent Card    = Agent çš„"åç‰‡"ï¼Œæè¿°èƒ½åŠ›         â”‚
â”‚  A2AServer     = æŠŠ Agent æš´éœ²ä¸ºç½‘ç»œæœåŠ¡          â”‚
â”‚  RemoteA2aAgent = è¿æ¥è¿œç¨‹ Agent çš„å®¢æˆ·ç«¯ä»£ç†      â”‚
â”‚                                                  â”‚
â”‚  MCP  = Agent è¿æ¥å·¥å…·å’Œæ•°æ®ï¼ˆå•ä¸ª Agent çš„èƒ½åŠ›ï¼‰  â”‚
â”‚  A2A  = Agent ä¹‹é—´äº’ç›¸é€šä¿¡ï¼ˆå¤šä¸ª Agent çš„åä½œï¼‰    â”‚
â”‚  ADK  = å¼€å‘æ¡†æ¶ï¼ŒåŒæ—¶æ”¯æŒ MCP å’Œ A2A             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å‚è€ƒèµ„æ–™

- [ADK A2A å®˜æ–¹æ–‡æ¡£ - Introduction](https://google.github.io/adk-docs/a2a/intro/)
- [ADK A2A Quickstart - Consuming](https://google.github.io/adk-docs/a2a/quickstart-consuming/)
- [Google Cloud Blog - Convert ADK agents for A2A](https://cloud.google.com/blog/products/ai-machine-learning/unlock-ai-agent-collaboration-convert-adk-agents-for-a2a)
